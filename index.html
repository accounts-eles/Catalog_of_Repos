<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic GitHub Repository Catalog</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind with the new brand color scheme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'brand-midnight': '#1f2a52',
                        'brand-teal': '#00bec7',
                        'brand-aqua': '#d2f0f0',
                        'brand-slate': '#abb5bf',
                        'bg-light': '#f8fafc',
                        'card-bg': '#ffffff',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar styling */
        .repo-container::-webkit-scrollbar {
            width: 8px;
        }
        .repo-container::-webkit-scrollbar-thumb {
            background-color: #abb5bf; /* brand-slate */
            border-radius: 4px;
        }
        .repo-container::-webkit-scrollbar-track {
            background: #d2f0f0; /* brand-aqua */
        }
        /* Custom checkbox and selection styling */
        .repo-checkbox {
            accent-color: #00bec7;
        }
        .repo-card-selected {
            border-color: #00bec7 !important;
            box-shadow: 0 0 0 2px #00bec7;
        }
        /* Tooltip style for selection boxes */
        .selection-tooltip {
            visibility: hidden;
            background-color: #1f2a52;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 20;
            bottom: 125%;
            right: 0;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 10px;
            white-space: nowrap;
        }
        .group:hover .selection-tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-bg-light min-h-screen font-sans p-4 sm:p-8 pb-32">

    <div class="max-w-4xl mx-auto">
        <!-- Header and Display Info -->
        <header class="text-center mb-8 p-8 bg-white shadow-sm rounded-2xl border border-brand-aqua">
            <h1 class="text-3xl font-extrabold text-brand-midnight mb-2">Public Repositories Catalog</h1>
            <p class="text-brand-slate">
                Displaying public repositories for:
                <span id="hardcodedUsernameDisplay" class="font-bold text-brand-teal"></span>
            </p>
        </header>

        <!-- Instructions Section -->
        <section class="mb-8 bg-brand-midnight text-white p-6 rounded-2xl shadow-md">
            <h2 class="text-lg font-bold mb-3 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2 text-brand-teal">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                </svg>
                How to Download Code
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-xs">
                <div class="bg-white/10 p-4 rounded-xl border border-white/10">
                    <span class="block text-brand-teal font-bold mb-1">Step 1: Select</span>
                    Click the selection square in the top-right corner of any repository card you want to include.
                </div>
                <div class="bg-white/10 p-4 rounded-xl border border-white/10">
                    <span class="block text-brand-teal font-bold mb-1">Step 2: Review</span>
                    The blue bar at the bottom will track your selection count. You can clear it at any time.
                </div>
                <div class="bg-white/10 p-4 rounded-xl border border-white/10">
                    <span class="block text-brand-teal font-bold mb-1">Step 3: Download</span>
                    Click "Download Bundle" to fetch the <code class="bg-brand-midnight px-1 text-brand-teal">index.html</code> and <code class="bg-brand-midnight px-1 text-brand-teal">README.md</code> for each project.
                </div>
            </div>
        </section>

        <!-- User Profile Display Section -->
        <div id="userProfile" class="bg-white p-6 rounded-2xl shadow-sm border border-brand-aqua mb-8 hidden">
            <!-- Profile content injected here -->
        </div>
        
        <!-- Repository Search Filter & Select All -->
        <div class="mb-6 flex flex-col sm:flex-row gap-4 items-center">
             <div class="relative flex-grow w-full">
                <input type="text" id="searchRepoInput" placeholder="Filter repositories..."
                       class="w-full p-3 border border-brand-slate rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-teal focus:border-transparent bg-white shadow-sm transition-all text-brand-midnight">
             </div>
             <button id="selectAllBtn" class="whitespace-nowrap px-6 py-3 bg-white border border-brand-slate rounded-xl text-sm font-semibold text-brand-midnight hover:bg-brand-aqua hover:border-brand-teal transition-all shadow-sm">
                Select All
             </button>
        </div>

        <!-- Loading Indicator & Error Message -->
        <div id="statusMessage" class="text-center text-lg text-brand-slate mb-4 hidden font-medium"></div>
        
        <!-- Repository Container -->
        <div id="repoContainer" class="repo-container grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Repository cards injected here -->
        </div>

        <!-- Footer -->
        <footer class="mt-12 text-center text-xs text-brand-slate uppercase tracking-widest font-semibold">
            &copy; GitHub REST API Connection • Local Preview Service
        </footer>
    </div>

    <!-- Pinned Download Action Bar -->
    <div id="downloadBar" class="fixed bottom-0 left-0 right-0 bg-brand-midnight text-white shadow-2xl p-5 transform translate-y-full transition-transform duration-500 ease-in-out z-50">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div class="flex items-center">
                <div class="bg-brand-teal text-brand-midnight px-3 py-1 rounded-full font-bold mr-3" id="selectedCount">0</div>
                <span class="text-brand-aqua font-medium">repositories selected for bundle</span>
            </div>
            <div class="flex space-x-4 items-center">
                <button id="clearSelectionBtn" class="text-sm font-bold text-brand-slate hover:text-white transition-colors">Clear All</button>
                <button id="downloadBundleBtn" class="flex items-center px-8 py-3 bg-brand-teal text-brand-midnight rounded-xl font-bold hover:brightness-110 active:scale-95 transition-all shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M7.5 12l4.5 4.5m0 0 4.5-4.5M12 3v13.5" />
                    </svg>
                    Download Bundle
                </button>
            </div>
        </div>
    </div>

    <script>
        const HARDCODED_USERNAME = 'accounts-eles';
        const EXCLUDED_REPO_NAME = 'Catalog_of_Repos';

        let currentRepos = []; 
        let selectedRepoIds = new Set();

        const repoContainer = document.getElementById('repoContainer');
        const statusMessage = document.getElementById('statusMessage');
        const usernameDisplay = document.getElementById('hardcodedUsernameDisplay');
        const searchRepoInput = document.getElementById('searchRepoInput');
        const downloadBar = document.getElementById('downloadBar');
        const selectedCountDisp = document.getElementById('selectedCount');
        const selectAllBtn = document.getElementById('selectAllBtn');

        window.onload = () => {
            usernameDisplay.textContent = HARDCODED_USERNAME;
            fetchAndDisplayRepos(HARDCODED_USERNAME);
            setupListeners();
        };

        function setupListeners() {
            searchRepoInput.addEventListener('input', handleSearch);
            
            selectAllBtn.addEventListener('click', () => {
                const visibleCheckboxes = document.querySelectorAll('.repo-checkbox');
                const allChecked = Array.from(visibleCheckboxes).every(cb => cb.checked);
                
                visibleCheckboxes.forEach(cb => {
                    cb.checked = !allChecked;
                    toggleRepoSelection(cb.dataset.id, !allChecked);
                    const card = cb.closest('.repo-card');
                    if (!allChecked) card.classList.add('repo-card-selected');
                    else card.classList.remove('repo-card-selected');
                });
            });

            document.getElementById('clearSelectionBtn').addEventListener('click', () => {
                selectedRepoIds.clear();
                document.querySelectorAll('.repo-checkbox').forEach(cb => {
                    cb.checked = false;
                    cb.closest('.repo-card').classList.remove('repo-card-selected');
                });
                updateDownloadBar();
            });

            document.getElementById('downloadBundleBtn').addEventListener('click', handleBulkDownload);
        }

        function toggleRepoSelection(repoId, isSelected) {
            if (isSelected) selectedRepoIds.add(repoId);
            else selectedRepoIds.delete(repoId);
            updateDownloadBar();
        }

        function updateDownloadBar() {
            const count = selectedRepoIds.size;
            selectedCountDisp.textContent = count;
            if (count > 0) downloadBar.classList.remove('translate-y-full');
            else downloadBar.classList.add('translate-y-full');
        }

        async function handleBulkDownload() {
            const btn = document.getElementById('downloadBundleBtn');
            const originalContent = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<span class="animate-spin mr-2">⏳</span> Processing...`;

            const selectedRepos = currentRepos.filter(r => selectedRepoIds.has(r.id.toString()));
            
            for (const repo of selectedRepos) {
                const branch = repo.default_branch || 'main';
                await downloadRawFile(repo.owner.login, repo.name, branch, 'index.html');
                await downloadRawFile(repo.owner.login, repo.name, branch, 'README.md');
            }

            btn.disabled = false;
            btn.innerHTML = originalContent;
        }

        async function downloadRawFile(owner, repo, branch, filename) {
            const url = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${filename}`;
            try {
                const resp = await fetch(url);
                if (!resp.ok) return;
                const blob = await resp.blob();
                const blobUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = blobUrl;
                a.download = `${repo}-${filename}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(blobUrl);
            } catch (e) { console.error(`Failed: ${repo}/${filename}`); }
        }

        function handleSearch() {
            const query = searchRepoInput.value.toLowerCase().trim();
            const filteredRepos = query ? currentRepos.filter(repo => {
                return repo.name.toLowerCase().includes(query) || 
                       (repo.description || '').toLowerCase().includes(query);
            }) : currentRepos;

            renderRepoCards(filteredRepos);
            
            if (filteredRepos.length === 0 && query) {
                displayStatus(`No results for "${query}".`, 'text-brand-slate');
            } else {
                displayStatus(`${filteredRepos.length} results matching filter:`, 'text-brand-teal');
            }
        }
        
        function displayStatus(message, className = 'text-brand-slate') {
            statusMessage.textContent = message;
            statusMessage.className = `text-center text-sm font-bold uppercase tracking-wide mb-4 ${className}`;
            statusMessage.classList.remove('hidden');
        }

        function displayProfile(user) {
            const profileElement = document.getElementById('userProfile');
            if (user.message === 'Not Found' || !user.login) return;

            const name = user.name || user.login;
            profileElement.innerHTML = `
                <div class="flex items-center">
                    <img src="${user.avatar_url}" alt="Avatar" class="w-16 h-16 rounded-2xl mr-5 border-2 border-brand-teal shadow-sm">
                    <div class="flex-grow">
                        <h2 class="text-xl font-bold text-brand-midnight">${name}</h2>
                        <p class="text-brand-slate text-sm font-medium mb-1">
                            @<a href="${user.html_url}" target="_blank" class="text-brand-teal hover:underline">${user.login}</a>
                        </p>
                        <p class="text-xs text-brand-midnight opacity-80 max-w-md">${user.bio || ''}</p>
                    </div>
                </div>
            `;
            profileElement.classList.remove('hidden');
        }

        function renderRepoCards(repos) {
            repoContainer.innerHTML = ''; 
            repos.forEach(repo => repoContainer.appendChild(createRepoCard(repo)));
        }

        async function fetchAndDisplayRepos(username) {
            displayStatus(`Fetching secure repository data...`, 'text-brand-teal');
            try {
                const [uResp, rResp] = await Promise.all([
                    fetch(`https://api.github.com/users/${username}`),
                    fetch(`https://api.github.com/users/${username}/repos?type=public&sort=pushed&per_page=100`)
                ]);

                if (uResp.status === 404) {
                    displayStatus(`Error: User not found.`, 'text-red-500');
                    return;
                }

                const userData = await uResp.json();
                const repoData = await rResp.json();

                currentRepos = repoData.filter(repo => repo.name !== EXCLUDED_REPO_NAME);
                displayProfile(userData);

                if (currentRepos.length === 0) {
                    displayStatus(`No public repositories found.`, 'text-brand-slate');
                } else {
                    displayStatus(`${currentRepos.length} Repositories Available:`);
                    renderRepoCards(currentRepos);
                }
            } catch (error) {
                displayStatus(`Connection error.`, 'text-red-500');
            }
        }

        function createRepoCard(repo) {
            const card = document.createElement('div');
            const repoIdStr = repo.id.toString();
            const isSelected = selectedRepoIds.has(repoIdStr);
            
            card.className = `repo-card relative bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 border-2 ${isSelected ? 'repo-card-selected' : 'border-brand-aqua'} flex flex-col overflow-hidden group`;
            
            const targetUrl = `https://${repo.owner.login.toLowerCase()}.github.io/${repo.name}/`;
            const placeholderUrl = `https://placehold.co/600x300/1f2a52/ffffff?text=${repo.name}`;
            const thumbnailUrl = `./previews/${repo.name}.png`;

            card.innerHTML = `
                <div class="absolute top-4 right-4 z-10 flex flex-col items-end">
                    <span class="selection-tooltip font-bold uppercase tracking-widest">Select to bundle</span>
                    <input type="checkbox" data-id="${repo.id}" class="repo-checkbox w-6 h-6 rounded-lg cursor-pointer shadow-sm" ${isSelected ? 'checked' : ''}>
                </div>
                <a href="${targetUrl}" target="_blank" class="block aspect-video bg-brand-aqua overflow-hidden">
                    <img src="${thumbnailUrl}" alt="${repo.name}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" onerror="this.onerror=null; this.src='${placeholderUrl}';">
                </a>
                <div class="p-6 flex flex-col flex-grow">
                    <div class="flex-grow">
                        <h2 class="text-lg font-bold text-brand-midnight group-hover:text-brand-teal transition-colors mb-2 truncate">${repo.name}</h2>
                        <p class="text-xs text-brand-slate font-medium leading-relaxed mb-4 line-clamp-2 h-8">${repo.description || 'No project description available.'}</p>
                    </div>
                    <div class="flex items-center justify-between mt-4 pt-4 border-t border-brand-aqua">
                        <span class="text-[10px] font-bold uppercase tracking-wider bg-brand-aqua text-brand-midnight px-2 py-1 rounded-md">${repo.language || 'Code'}</span>
                        <span class="text-[10px] font-bold text-brand-slate uppercase">Updated ${timeSince(new Date(repo.pushed_at))}</span>
                    </div>
                </div>
            `;

            const cb = card.querySelector('.repo-checkbox');
            cb.addEventListener('change', (e) => {
                toggleRepoSelection(repoIdStr, e.target.checked);
                if (e.target.checked) card.classList.add('repo-card-selected');
                else card.classList.remove('repo-card-selected');
            });

            return card;
        }

        function timeSince(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + "y";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + "mo";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + "d";
            return "today";
        }
    </script>
</body>
</html>
