<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic GitHub Repository Catalog</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind with the new brand color scheme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'brand-midnight': '#1f2a52',
                        'brand-teal': '#00bec7',
                        'brand-aqua': '#d2f0f0',
                        'brand-slate': '#abb5bf',
                        'bg-light': '#f8fafc',
                        'card-bg': '#ffffff',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar styling */
        .repo-container::-webkit-scrollbar {
            width: 8px;
        }
        .repo-container::-webkit-scrollbar-thumb {
            background-color: #abb5bf;
            border-radius: 4px;
        }
        .repo-container::-webkit-scrollbar-track {
            background: #d2f0f0;
        }
        .repo-checkbox {
            accent-color: #00bec7;
        }
        .repo-card-selected {
            border-color: #00bec7 !important;
            box-shadow: 0 0 0 2px #00bec7;
        }
        .selection-tooltip {
            visibility: hidden;
            background-color: #1f2a52;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 20;
            bottom: 125%;
            right: 0;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 10px;
            white-space: nowrap;
        }
        .group:hover .selection-tooltip {
            visibility: visible;
            opacity: 1;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* PRINT STYLES - Designed for Pretty PDF Generation */
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
                color: #1f2a52;
            }
            header, section, #topicFilterContainer, #searchRepoInput, #selectAllBtn, 
            #downloadBar, footer, .repo-checkbox, .selection-tooltip, .print-btn-container, .print-hide, #setupInstructions {
                display: none !important;
            }
            #userProfile {
                display: block !important;
                border: none !important;
                box-shadow: none !important;
                margin-bottom: 2rem !important;
                padding: 0 !important;
            }
            #userProfile img {
                width: 80px !important;
                height: 80px !important;
            }
            #repoContainer {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 1rem !important;
            }
            .repo-card {
                break-inside: avoid;
                margin-bottom: 0 !important;
                border: 1px solid #d2f0f0 !important;
                box-shadow: none !important;
                display: flex !important;
                flex-direction: column !important;
                height: auto !important;
            }
            .repo-card a {
                width: 100% !important;
                height: 100px !important;
            }
            .repo-card .p-6 {
                width: 100% !important;
                padding: 0.75rem !important;
            }
            .repo-card h2 {
                font-size: 1rem !important;
                color: #1f2a52 !important;
            }
            .repo-card p {
                -webkit-line-clamp: 2 !important;
                height: auto !important;
                font-size: 0.75rem !important;
                margin-bottom: 0.5rem !important;
            }
        }
    </style>
</head>
<body class="bg-bg-light min-h-screen font-sans p-4 sm:p-8 pb-32">

    <div id="printableArea" class="max-w-4xl mx-auto">
        <!-- Header and Display Info -->
        <header class="text-center mb-8 p-8 bg-white shadow-sm rounded-2xl border border-brand-aqua relative print-hide">
            <h1 class="text-3xl font-extrabold text-brand-midnight mb-2">Public Repositories Catalog</h1>
            <p class="text-brand-slate">
                Displaying public repositories for:
                <span id="hardcodedUsernameDisplay" class="font-bold text-brand-teal"></span>
            </p>
        </header>

        <!-- User Profile Display Section -->
        <div id="userProfile" class="bg-white p-6 rounded-2xl shadow-sm border border-brand-aqua mb-8 hidden">
            <!-- Profile content injected here -->
        </div>

        <!-- Tools & Instructions Section (Moved below profile) -->
        <section id="setupInstructions" class="mb-8 bg-brand-midnight text-white p-6 rounded-2xl shadow-md print-hide">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
                <h3 class="text-xl font-bold flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 mr-3 text-brand-teal">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                    </svg>
                    How to download the code
                </h3>
                <button id="printBtn" class="print-btn-container flex items-center px-4 py-2 bg-brand-teal text-brand-midnight rounded-xl font-bold hover:brightness-110 active:scale-95 transition-all shadow-lg text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.72 13.89l-4.72-4.72a.75.75 0 010-1.06l4.72-4.72a.75.75 0 011.06 0l4.72 4.72a.75.75 0 010 1.06l-4.72 4.72a.75.75 0 01-1.06 0zM17.28 13.89l4.72-4.72a.75.75 0 000-1.06l-4.72-4.72a.75.75 0 00-1.06 0l-4.72 4.72a.75.75 0 000 1.06l4.72 4.72a.75.75 0 001.06 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v13.5m-3-3l3 3 3-3" />
                    </svg>
                    <span id="printBtnText">Print Catalog</span>
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Step 1 -->
                <div class="bg-white/10 border border-white/20 p-5 rounded-xl">
                    <h4 class="text-brand-teal font-bold text-sm mb-2 uppercase tracking-wide">Step 1: Select</h4>
                    <p class="text-xs leading-relaxed text-slate-200">
                        Click the selection square in the top-right corner of any repository card you want to include.
                    </p>
                </div>
                <!-- Step 2 -->
                <div class="bg-white/10 border border-white/20 p-5 rounded-xl">
                    <h4 class="text-brand-teal font-bold text-sm mb-2 uppercase tracking-wide">Step 2: Review</h4>
                    <p class="text-xs leading-relaxed text-slate-200">
                        The blue bar at the bottom will track your selection count. You can clear it at any time.
                    </p>
                </div>
                <!-- Step 3 -->
                <div class="bg-white/10 border border-white/20 p-5 rounded-xl">
                    <h4 class="text-brand-teal font-bold text-sm mb-2 uppercase tracking-wide">Step 3: Download</h4>
                    <p class="text-xs leading-relaxed text-slate-200">
                        Click "Download Bundle" to fetch the <code class="bg-brand-midnight px-1 rounded text-brand-teal">index.html</code> and <code class="bg-brand-midnight px-1 rounded text-brand-teal">README.md</code> for each project.
                    </p>
                </div>
            </div>
        </section>
        
        <!-- Repository Search & Topic Filters -->
        <div class="mb-8 print-hide">
            <div class="flex flex-col sm:flex-row gap-4 items-center mb-4">
                 <div class="relative flex-grow w-full">
                    <input type="text" id="searchRepoInput" placeholder="Filter repositories by name or description..."
                           class="w-full p-3 border border-brand-slate rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-teal focus:border-transparent bg-white shadow-sm transition-all text-brand-midnight">
                 </div>
                 <button id="selectAllBtn" class="whitespace-nowrap px-6 py-3 bg-white border border-brand-slate rounded-xl text-sm font-semibold text-brand-midnight hover:bg-brand-aqua hover:border-brand-teal transition-all shadow-sm">
                    Select All
                 </button>
            </div>
            
            <div id="topicFilterContainer" class="flex flex-wrap gap-2 items-center hide-scrollbar">
                <!-- Topics injected here -->
            </div>
        </div>

        <!-- Loading Indicator & Error Message -->
        <div id="statusMessage" class="text-center text-lg text-brand-slate mb-4 hidden font-medium"></div>
        
        <!-- Repository Container -->
        <div id="repoContainer" class="repo-container grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Repository cards injected here -->
        </div>

        <!-- Footer -->
        <footer class="mt-12 text-center text-xs text-brand-slate uppercase tracking-widest font-semibold print-hide">
            &copy; GitHub REST API Connection ‚Ä¢ Local Preview Service
        </footer>
    </div>

    <!-- Pinned Download Action Bar -->
    <div id="downloadBar" class="fixed bottom-0 left-0 right-0 bg-brand-midnight text-white shadow-2xl p-5 transform translate-y-full transition-transform duration-500 ease-in-out z-50 print-hide">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div class="flex items-center">
                <div class="bg-brand-teal text-brand-midnight px-3 py-1 rounded-full font-bold mr-3" id="selectedCount">0</div>
                <span class="text-brand-aqua font-medium">repositories selected for bundle</span>
            </div>
            <div class="flex space-x-4 items-center">
                <button id="clearSelectionBtn" class="text-sm font-bold text-brand-slate hover:text-white transition-colors">Clear All</button>
                <button id="downloadBundleBtn" class="flex items-center px-8 py-3 bg-brand-teal text-brand-midnight rounded-xl font-bold hover:brightness-110 active:scale-95 transition-all shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M7.5 12l4.5 4.5m0 0 4.5-4.5M12 3v13.5" />
                    </svg>
                    Download Bundle
                </button>
            </div>
        </div>
    </div>

    <script>
        const HARDCODED_USERNAME = 'accounts-eles';
        const EXCLUDED_REPO_NAME = 'Catalog_of_Repos';

        let currentRepos = []; 
        let selectedRepoIds = new Set();
        let selectedTopic = null;

        const repoContainer = document.getElementById('repoContainer');
        const topicFilterContainer = document.getElementById('topicFilterContainer');
        const statusMessage = document.getElementById('statusMessage');
        const usernameDisplay = document.getElementById('hardcodedUsernameDisplay');
        const searchRepoInput = document.getElementById('searchRepoInput');
        const downloadBar = document.getElementById('downloadBar');
        const selectedCountDisp = document.getElementById('selectedCount');
        const selectAllBtn = document.getElementById('selectAllBtn');
        const printBtn = document.getElementById('printBtn');

        window.onload = () => {
            usernameDisplay.textContent = HARDCODED_USERNAME;
            fetchAndDisplayRepos(HARDCODED_USERNAME);
            setupListeners();
        };

        function setupListeners() {
            searchRepoInput.addEventListener('input', updateFilters);
            
            printBtn.addEventListener('click', () => {
                const textSpan = document.getElementById('printBtnText');
                const originalText = textSpan.textContent;
                textSpan.textContent = "Generating...";

                if (window.self !== window.top) {
                    const printWindow = window.open('', '_blank');
                    const html = document.documentElement.outerHTML;
                    
                    printWindow.document.open();
                    printWindow.document.write(html);
                    printWindow.document.close();
                    
                    setTimeout(() => {
                        printWindow.print();
                        textSpan.textContent = originalText;
                    }, 1000);
                } else {
                    window.print();
                    textSpan.textContent = originalText;
                }
            });

            selectAllBtn.addEventListener('click', () => {
                const visibleCheckboxes = document.querySelectorAll('.repo-checkbox');
                const allChecked = Array.from(visibleCheckboxes).every(cb => cb.checked);
                
                visibleCheckboxes.forEach(cb => {
                    cb.checked = !allChecked;
                    toggleRepoSelection(cb.dataset.id, !allChecked);
                    const card = cb.closest('.repo-card');
                    if (!allChecked) card.classList.add('repo-card-selected');
                    else card.classList.remove('repo-card-selected');
                });
            });

            document.getElementById('clearSelectionBtn').addEventListener('click', () => {
                selectedRepoIds.clear();
                document.querySelectorAll('.repo-checkbox').forEach(cb => {
                    cb.checked = false;
                    cb.closest('.repo-card').classList.remove('repo-card-selected');
                });
                updateDownloadBar();
            });

            document.getElementById('downloadBundleBtn').addEventListener('click', handleBulkDownload);
        }

        function toggleRepoSelection(repoId, isSelected) {
            if (isSelected) selectedRepoIds.add(repoId);
            else selectedRepoIds.delete(repoId);
            updateDownloadBar();
        }

        function updateDownloadBar() {
            const count = selectedRepoIds.size;
            selectedCountDisp.textContent = count;
            if (count > 0) downloadBar.classList.remove('translate-y-full');
            else downloadBar.classList.add('translate-y-full');
        }

        async function handleBulkDownload() {
            const btn = document.getElementById('downloadBundleBtn');
            const originalContent = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<span class="animate-spin mr-2">‚è≥</span> Processing...`;

            const selectedRepos = currentRepos.filter(r => selectedRepoIds.has(r.id.toString()));
            
            for (const repo of selectedRepos) {
                const branch = repo.default_branch || 'main';
                await downloadRawFile(repo.owner.login, repo.name, branch, 'index.html');
                await downloadRawFile(repo.owner.login, repo.name, branch, 'README.md');
            }

            btn.disabled = false;
            btn.innerHTML = originalContent;
        }

        async function downloadRawFile(owner, repo, branch, filename) {
            const url = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${filename}`;
            try {
                const resp = await fetch(url);
                if (!resp.ok) return;
                const blob = await resp.blob();
                const blobUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = blobUrl;
                a.download = `${repo}-${filename}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(blobUrl);
            } catch (e) { console.error(`Failed: ${repo}/${filename}`); }
        }

        function updateFilters() {
            const query = searchRepoInput.value.toLowerCase().trim();
            
            const filteredRepos = currentRepos.filter(repo => {
                const matchesSearch = !query || 
                    repo.name.toLowerCase().includes(query) || 
                    (repo.description || '').toLowerCase().includes(query);
                
                const matchesTopic = !selectedTopic || 
                    (repo.topics && repo.topics.includes(selectedTopic));

                return matchesSearch && matchesTopic;
            });

            renderRepoCards(filteredRepos);
            
            if (filteredRepos.length === 0 && (query || selectedTopic)) {
                displayStatus(`No results found.`, 'text-brand-slate');
            } else {
                displayStatus(`${filteredRepos.length} results matching filter:`, 'text-brand-teal');
            }
        }

        function renderTopics(repos) {
            const topics = new Set();
            repos.forEach(repo => {
                if (repo.topics) {
                    repo.topics.forEach(topic => topics.add(topic));
                }
            });

            const sortedTopics = Array.from(topics).sort();
            
            topicFilterContainer.innerHTML = `
                <button class="topic-btn px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider transition-all border-2 ${!selectedTopic ? 'bg-brand-midnight text-white border-brand-midnight' : 'bg-white text-brand-slate border-brand-aqua hover:border-brand-teal hover:text-brand-teal'}" data-topic="null">
                    All Topics
                </button>
            `;

            sortedTopics.forEach(topic => {
                const isActive = selectedTopic === topic;
                const btn = document.createElement('button');
                btn.className = `topic-btn px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider transition-all border-2 ${isActive ? 'bg-brand-midnight text-white border-brand-midnight' : 'bg-white text-brand-slate border-brand-aqua hover:border-brand-teal hover:text-brand-teal'}`;
                btn.textContent = topic;
                btn.dataset.topic = topic;
                topicFilterContainer.appendChild(btn);
            });

            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const topic = btn.dataset.topic === 'null' ? null : btn.dataset.topic;
                    selectedTopic = topic;
                    renderTopics(repos);
                    updateFilters();
                });
            });
        }
        
        function displayStatus(message, className = 'text-brand-slate') {
            statusMessage.textContent = message;
            statusMessage.className = `text-center text-sm font-bold uppercase tracking-wide mb-4 ${className}`;
            statusMessage.classList.remove('hidden');
        }

        function displayProfile(user) {
            const profileElement = document.getElementById('userProfile');
            if (user.message === 'Not Found' || !user.login) return;

            const name = user.name || user.login;
            profileElement.innerHTML = `
                <div class="flex items-start">
                    <img src="${user.avatar_url}" alt="Avatar" class="w-16 h-16 rounded-2xl mr-6 border-2 border-brand-teal shadow-sm">
                    <div class="flex-grow">
                        <h2 class="text-2xl font-bold text-brand-midnight leading-tight">${name}</h2>
                        <div class="flex flex-wrap gap-x-4 gap-y-1 text-sm text-brand-slate font-medium mb-2">
                            <span>@<a href="${user.html_url}" target="_blank" class="text-brand-teal hover:underline">${user.login}</a></span>
                            ${user.location ? `<span>üìç ${user.location}</span>` : ''}
                            ${user.blog ? `<span>üåê <a href="${user.blog.startsWith('http') ? user.blog : 'https://'+user.blog}" class="hover:text-brand-teal">${user.blog}</a></span>` : ''}
                        </div>
                        <p class="text-sm text-brand-midnight opacity-80 max-w-2xl">${user.bio || ''}</p>
                    </div>
                </div>
            `;
            profileElement.classList.remove('hidden');
        }

        function renderRepoCards(repos) {
            repoContainer.innerHTML = ''; 
            repos.forEach(repo => repoContainer.appendChild(createRepoCard(repo)));
        }

        async function fetchAndDisplayRepos(username) {
            displayStatus(`Fetching secure repository data...`, 'text-brand-teal');
            try {
                const [uResp, rResp] = await Promise.all([
                    fetch(`https://api.github.com/users/${username}`),
                    fetch(`https://api.github.com/users/${username}/repos?type=public&sort=pushed&per_page=100`)
                ]);

                if (uResp.status === 404) {
                    displayStatus(`Error: User not found.`, 'text-red-500');
                    return;
                }

                const userData = await uResp.json();
                const repoData = await rResp.json();

                currentRepos = repoData.filter(repo => 
                    repo.name !== EXCLUDED_REPO_NAME && 
                    repo.topics && 
                    repo.topics.length > 0
                );
                
                displayProfile(userData);

                if (currentRepos.length === 0) {
                    displayStatus(`No public repositories with topics found.`, 'text-brand-slate');
                } else {
                    displayStatus(`${currentRepos.length} Repositories Ready:`);
                    renderTopics(currentRepos);
                    renderRepoCards(currentRepos);
                }
            } catch (error) {
                displayStatus(`Connection error.`, 'text-red-500');
            }
        }

        function createRepoCard(repo) {
            const card = document.createElement('div');
            const repoIdStr = repo.id.toString();
            const isSelected = selectedRepoIds.has(repoIdStr);
            
            card.className = `repo-card relative bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 border-2 ${isSelected ? 'repo-card-selected' : 'border-brand-aqua'} flex flex-col overflow-hidden group`;
            
            const targetUrl = `https://${repo.owner.login.toLowerCase()}.github.io/${repo.name}/`;
            const placeholderUrl = `https://placehold.co/600x300/1f2a52/ffffff?text=${repo.name}`;
            const thumbnailUrl = `./previews/${repo.name}.png`;

            const topicsHtml = (repo.topics || []).map(t => 
                `<span class="text-[9px] font-bold text-brand-teal border border-brand-teal px-1.5 py-0.5 rounded uppercase mr-1 mb-1">${t}</span>`
            ).join('');

            card.innerHTML = `
                <div class="absolute top-4 right-4 z-10 flex flex-col items-end print:hidden">
                    <span class="selection-tooltip font-bold uppercase tracking-widest">Select to bundle</span>
                    <input type="checkbox" data-id="${repo.id}" class="repo-checkbox w-6 h-6 rounded-lg cursor-pointer shadow-sm" ${isSelected ? 'checked' : ''}>
                </div>
                <a href="${targetUrl}" target="_blank" class="block aspect-video bg-brand-aqua overflow-hidden">
                    <img src="${thumbnailUrl}" alt="${repo.name}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" onerror="this.onerror=null; this.src='${placeholderUrl}';">
                </a>
                <div class="p-6 flex flex-col flex-grow">
                    <div class="flex-grow">
                        <h2 class="text-lg font-bold text-brand-midnight group-hover:text-brand-teal transition-colors mb-2 truncate">${repo.name}</h2>
                        <p class="text-xs text-brand-slate font-medium leading-relaxed mb-4 line-clamp-2 h-8">${repo.description || 'No project description available.'}</p>
                    </div>
                    <div class="mt-4 pt-4 border-t border-brand-aqua">
                        <div class="flex flex-wrap mb-2">
                            ${topicsHtml}
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex flex-col">
                                <span class="text-[10px] font-bold uppercase tracking-wider bg-brand-aqua text-brand-midnight px-2 py-1 rounded-md inline-block w-fit mb-1">${repo.language || 'Code'}</span>
                                <span class="text-[8px] text-brand-slate hidden print:inline">URL: ${targetUrl}</span>
                            </div>
                            <span class="text-[10px] font-bold text-brand-slate uppercase">Updated ${timeSince(new Date(repo.pushed_at))}</span>
                        </div>
                    </div>
                </div>
            `;

            const cb = card.querySelector('.repo-checkbox');
            cb.addEventListener('change', (e) => {
                toggleRepoSelection(repoIdStr, e.target.checked);
                if (e.target.checked) card.classList.add('repo-card-selected');
                else card.classList.remove('repo-card-selected');
            });

            return card;
        }

        function timeSince(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + "y";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + "mo";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + "d";
            return "today";
        }
    </script>
</body>
</html>
